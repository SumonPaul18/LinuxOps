# ЁЯз░ Samba ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи ржУ ржЯрзНрж░рж╛ржмрж▓рж╢рзБржЯрж┐ржВ ржЧрж╛ржЗржб (Ubuntu)

## ЁЯФ╣ 1. Samba ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи

```bash
# Samba ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛
dpkg -l | grep samba

# ржЖржЙржЯржкрзБржЯрзЗ ржерж╛ржХрж╛ ржЙржЪрж┐ржд:
# ii  samba    <version>   ...
```

ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ:
```bash
sudo apt update && sudo apt install samba -y
```

---

## ЁЯФ╣ 2. Samba рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ ржХрж░рзБржи

Samba ржжрзБржЯрж┐ ржкрзНрж░ржзрж╛ржи рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рж╛ржпрж╝:

- `smbd` тЖТ SMB/CIFS рж╢рзЗржпрж╝рж╛рж░ ржорзНржпрж╛ржирзЗржЬ ржХрж░рзЗ
- `nmbd` тЖТ NetBIOS ржирзЗржо рж░рзЗржЬрзЛрж▓рж┐ржЙрж╢ржи (LAN ржбрж┐рж╕ржХржнрж╛рж░рж┐)

```bash
# рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕
sudo systemctl status smbd
sudo systemctl status nmbd

# рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ/ржмржирзНржз/рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ
sudo systemctl start smbd nmbd
sudo systemctl stop smbd nmbd
sudo systemctl restart smbd nmbd

# ржмрзБржЯ ржЯрж╛ржЗржорзЗ ржЕржЯрзЛ рж╕рзНржЯрж╛рж░рзНржЯ рж╕рзЗржЯ ржХрж░рзБржи
sudo systemctl enable smbd nmbd
```

> тЬЕ **Expected**: `active (running)` ржжрзЗржЦрж╛ржирзЛ ржЙржЪрж┐рждред

---

## ЁЯФ╣ 3. Samba ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓ (`/etc/samba/smb.conf`) ржЪрзЗржХ ржХрж░рзБржи

### a. ржХржиржлрж┐ржЧ ржлрж╛ржЗрж▓ ржжрзЗржЦрзБржи:
```bash
cat /etc/samba/smb.conf
```

### b. ржирзНржпрзВржирждржо ржнрж╛рж▓рзЛ ржХржиржлрж┐ржЧ (example):
```ini
[global]
   workgroup = WORKGROUP
   server string = Samba Server %v
   netbios name = ubuntu-samba
   security = user
   map to guest = never
   dns proxy = no
   log file = /var/log/samba/log.%m
   max log size = 1000
   server min protocol = SMB2
   server max protocol = SMB3

[shared]
   path = /srv/samba/shared
   browsable = yes
   writable = yes
   guest ok = no
   read only = no
   valid users = sumon
```

> тЪая╕П **ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг**:  
> - `security = user` тЖТ ржЗржЙржЬрж╛рж░ ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи ржкрзНрж░ржпрж╝рзЛржЬржи  
> - `guest ok = no` тЖТ ржЧрзЗрж╕рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирж┐рж╖рж┐ржжрзНржз  
> - `server min protocol = SMB2` тЖТ Windows 10/11 рж╕рж╛ржкрзЛрж░рзНржЯрзЗрж░ ржЬржирзНржп (SMB1 insecure)

### c. ржХржиржлрж┐ржЧ ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи:
```bash
testparm
```
> тЬЕ ржЖржЙржЯржкрзБржЯрзЗ "Loaded services file OK" ржжрзЗржЦрж╛ржирзЛ ржЙржЪрж┐рждред  
> тЭМ ржпржжрж┐ ржПрж░рж░ ржжрзЗржЦрж╛ржпрж╝ тЖТ ржХржиржлрж┐ржЧ ржлрж╛ржЗрж▓рзЗ ржнрзБрж▓ ржЖржЫрзЗред

---

## ЁЯФ╣ 4. ржХрзЛржи рж╢рзЗржпрж╝рж╛рж░ржЧрзБрж▓рзЛ ржПржХрзНржЯрж┐ржн ржЖржЫрзЗ рждрж╛ ржЪрзЗржХ ржХрж░рзБржи

```bash
# рж▓рзЛржХрж╛рж▓ ржерзЗржХрзЗ рж╢рзЗржпрж╝рж╛рж░ рж▓рж┐рж╕рзНржЯ ржХрж░рзБржи
smbclient -L localhost -U%

# ржЕржержмрж╛ ржЗржЙржЬрж╛рж░ ржжрж┐ржпрж╝рзЗ (ржпржжрж┐ guest ржирж╛ ржерж╛ржХрзЗ)
smbclient -L localhost -U sumon
```

> тЬЕ ржЖржЙржЯржкрзБржЯрзЗ `[shared]` ржмрж╛ ржЖржкржирж╛рж░ рж╢рзЗржпрж╝рж╛рж░ ржирж╛ржо ржжрзЗржЦрж╛ржирзЛ ржЙржЪрж┐рждред

---

## ЁЯФ╣ 5. Samba ржЗржЙржЬрж╛рж░ ржЪрзЗржХ ржХрж░рзБржи

### a. Samba ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржЗржЙржЬрж╛рж░ ржЖржЫрзЗ ржХрж┐ржирж╛?
```bash
sudo pdbedit -L -v
```

> ржЖржЙржЯржкрзБржЯрзЗ `sumon` ржЗржЙржЬрж╛рж░ ржжрзЗржЦрж╛ржирзЛ ржЙржЪрж┐рждред

### b. ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ ржирж╛ ржерж╛ржХрж▓рзЗ:
```bash
sudo smbpasswd -a sumon
```

> тЪая╕П рж▓рж┐ржирж╛ржХрзНрж╕ рж╕рж┐рж╕рзНржЯрзЗржо ржЗржЙржЬрж╛рж░ржУ ржерж╛ржХрждрзЗ рж╣ржмрзЗ:
```bash
id sumon  # ржЪрзЗржХ ржХрж░рзБржи
```

ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ:
```bash
sudo useradd -M -s /sbin/nologin sumon
```

---

## ЁЯФ╣ 6. рж╢рзЗржпрж╝рж╛рж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржУ ржкрж╛рж░ржорж┐рж╢ржи ржЪрзЗржХ ржХрж░рзБржи

### a. ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржЖржЫрзЗ ржХрж┐ржирж╛?
```bash
ls -ld /srv/samba/shared
```

### b. ржкрж╛рж░ржорж┐рж╢ржи:
```bash
# ржЙржжрж╛рж╣рж░ржг: sumon ржЗржЙржЬрж╛рж░рзЗрж░ ржорж╛рж▓рж┐ржХрж╛ржирж╛
sudo chown -R sumon:sumon /srv/samba/shared
sudo chmod -R 0755 /srv/samba/shared
```

> тЬЕ Samba ржЗржЙржЬрж╛рж░ **ржЕржмрж╢рзНржпржЗ** ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рж░ ржорж╛рж▓рж┐ржХ ржмрж╛ ржЧрзНрж░рзБржк ржорзЗржорзНржмрж╛рж░ рж╣рждрзЗ рж╣ржмрзЗред

---

## ЁЯФ╣ 7. рж▓рзЛржХрж╛рж▓ ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓ (UFW/iptables) ржЪрзЗржХ ржХрж░рзБржи

```bash
# UFW ржЪрж╛рж▓рзБ ржХрж┐ржирж╛?
sudo ufw status verbose

# ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзЛрж░рзНржЯ ржЦрзЛрж▓рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛?
sudo ufw allow 139/tcp
sudo ufw allow 445/tcp
```

ржпржжрж┐ `iptables` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи:
```bash
sudo iptables -L -n | grep -E '139|445'
```

> тЬЕ ржкрзЛрж░рзНржЯ 139/tcp ржУ 445/tcp **ACCEPT** рж╣рждрзЗ рж╣ржмрзЗред

---

## ЁЯФ╣ 8. рж▓рзЛржХрж╛рж▓ ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржерзЗржХрзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи (LAN)

Windows ржмрж╛ ржЕржирзНржп Ubuntu PC ржерзЗржХрзЗ:
```
\\192.168.0.93\shared
```

> тЬЕ LAN ржерзЗржХрзЗ ржХрж╛ржЬ ржХрж░рж▓рзЗ тЖТ Samba рж╕рж╛рж░рзНржнрж╛рж░ ржарж┐ржХ ржЖржЫрзЗред  
> тЭМ LAN ржерзЗржХрзЗржУ ржирж╛ ржХрж╛ржЬ ржХрж░рж▓рзЗ тЖТ Samba ржХржиржлрж┐ржЧ/ржкрж╛рж░ржорж┐рж╢ржи рж╕ржорж╕рзНржпрж╛ред

---

## ЁЯФ╣ 9. MikroTik Port Forwarding ржУ ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓ ржнрзЗрж░рж┐ржлрж╛ржЗ

### a. NAT Rule ржЪрзЗржХ:
```routeros
/ip firewall nat print
```
ржЖржЙржЯржкрзБржЯрзЗ ржерж╛ржХрж╛ ржЙржЪрж┐ржд:
```
chain=dstnat dst-address=105.116.19.230 protocol=tcp dst-port=139 action=dst-nat to-addresses=192.168.0.93
chain=dstnat dst-address=105.116.19.230 protocol=tcp dst-port=445 action=dst-nat to-addresses=192.168.0.93
```

### b. Input Chain ржлрж┐рж▓рзНржЯрж╛рж░:
```routeros
/ip firewall filter print chain=input
```
TCP 139/445 ржкрзЛрж░рзНржЯрзЗрж░ ржЬржирзНржп `accept` рж░рзБрж▓ ржерж╛ржХрждрзЗ рж╣ржмрзЗред

### c. ржкрзЛрж░рзНржЯ ржУржкрзЗржи ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи (ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ):
```bash
# ржорзЛржмрж╛ржЗрж▓ ржбрзЗржЯрж╛ ржмрж╛ ржЕржирзНржп ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржерзЗржХрзЗ
nmap -p 139,445 105.116.19.230
```

> тЬЕ ржЖржЙржЯржкрзБржЯрзЗ `open` ржжрзЗржЦрж╛ржирзЛ ржЙржЪрж┐рждред  
> тЭМ `filtered` ржмрж╛ `closed` тЖТ MikroTik ржмрж╛ ISP ржмрзНрж▓ржХ ржХрж░ржЫрзЗред

---

## ЁЯФ╣ 10. Windows 10 рж╕рж╛ржЗржб ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

1. **SMB1 ржбрж┐рж╕рзЗржмрж▓ ржХрж░рж╛ ржЖржЫрзЗ ржХрж┐ржирж╛?** тЖТ ржнрж╛рж▓рзЛ, ржХрж┐ржирзНрждрзБ Samba SMB2/3 рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред
2. **Credential Manager** ржХрзНрж▓рж┐ржпрж╝рж╛рж░ ржХрж░рзБржи (ржкрзБрж░ржирзЛ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ ржЭрж╛ржорзЗрж▓рж╛ ржХрж░рзЗ)ред
3. **Antivirus/Firewall** рж╕рж╛ржоржпрж╝рж┐ржХ ржмржирзНржз ржХрж░рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржиред
4. **File Explorer**-ржП рж▓рж┐ржЦрзБржи:
   ```
   \\105.116.19.230\shared
   ```

---

## ЁЯФ╣ 11. Samba рж▓ржЧ ржЪрзЗржХ ржХрж░рзБржи (Debugging)

```bash
# рж▓ржЧ ржлрж╛ржЗрж▓ ржжрзЗржЦрзБржи
sudo tail -f /var/log/samba/log.smbd
sudo tail -f /var/log/samba/log.<windows-pc-name>
```

> ржПржЦрж╛ржирзЗ authentication failure, permission denied, ржмрж╛ connection refused ржПрж░рж░ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗред

---

## ЁЯФ╣ 12. Advanced: Samba ржХржиржлрж┐ржЧ ржЕржкрж╢ржи (Optional but Recommended)

| ржЕржкрж╢ржи | ржмрзНржпрж╛ржЦрзНржпрж╛ |
|------|--------|
| `server min protocol = SMB2` | Windows 10/11 рж╕рж╛ржкрзЛрж░рзНржЯ |
| `server max protocol = SMB3` | ржПржиржХрзНрж░рж┐ржкрж╢ржи рж╕рж╛ржкрзЛрж░рзНржЯ |
| `hosts allow = 192.168.0. 105.116.19.230` | IP-based access control (use carefully) |
| `log level = 2` | ржбрж┐ржмрж╛ржЧрж┐ржВржпрж╝рзЗрж░ ржЬржирзНржп рж▓ржЧ рж▓рзЗржнрзЗрж▓ ржмрж╛ржбрж╝рж╛ржи |

> тЪая╕П `hosts allow` WAN IP ржжрж┐рж▓рзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛ тАФ ржХрж╛рж░ржг Samba LAN IP ржжрзЗржЦрзЗред рждрж╛ржЗ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛ ржпржжрж┐ ржирж╛ ржЖржкржирж┐ NATed IP ржЬрж╛ржирзЗржиред

---

## ЁЯФ╣ 13. Alternative Secure Solution (Recommended for Internet)

ржпрзЗрж╣рзЗрждрзБ **SMB over public internet is risky**, ржирж┐ржЪрзЗрж░ ржпрзЗржХрзЛржирзЛ ржПржХржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:

- **Tailscale**: Zero-config VPN тЖТ Samba LAN-ржПрж░ ржорждрзЛ ржХрж╛ржЬ ржХрж░ржмрзЗред
- **Cloudflare Tunnel**: `cloudflared` ржжрж┐ржпрж╝рзЗ SMB ржирж╛, ржХрж┐ржирзНрждрзБ Web UI (e.g., FileBrowser) ржПржХрзНрж╕ржкрзЛржЬ ржХрж░рзБржиред
- **WireGuard**: ржирж┐ржЬрзЗрж░ рж╕рж┐ржХрж┐ржЙрж░ ржЯрж╛ржирзЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржиред

---

## тЬЕ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк: ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

| ржзрж╛ржк | рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ |
|-----|--------|
| Samba ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржЖржЫрзЗ? | тЬЕ / тЭМ |
| `smbd` & `nmbd` running? | тЬЕ / тЭМ |
| `testparm` OK? | тЬЕ / тЭМ |
| рж╢рзЗржпрж╝рж╛рж░ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржУ ржкрж╛рж░ржорж┐рж╢ржи ржарж┐ржХ? | тЬЕ / тЭМ |
| Samba ржЗржЙржЬрж╛рж░ ржЖржЫрзЗ? | тЬЕ / тЭМ |
| LAN ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛ржпрж╝? | тЬЕ / тЭМ |
| MikroTik NAT rule ржарж┐ржХ? | тЬЕ / тЭМ |
| MikroTik input filter allow? | тЬЕ / тЭМ |
| Public IP ржкрзЛрж░рзНржЯ open (nmap)? | тЬЕ / тЭМ |
| Windows credential clear? | тЬЕ / тЭМ |

---
